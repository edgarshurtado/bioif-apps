<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../app-wrapper/app-wrapper.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">


<dom-module id="app-collection">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment">
            app-wrapper {
                --app-wrap-width: 250px;
                --app-icon-height: 150px;
                margin: 10px;
            }

            .infoScreen{
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                width: 100%;
                background-color: rgba(0,0,0, 0.9);
                z-index: 1000;
            }

            .infoScreen .closeButton {
                position: absolute;
                right: 3%;
                top: 3%;
                border-radius: 50%;
                width: 30px;
                height: 30px;
                border: white solid 3px;
                color: white;
                z-index: 1001;
            }
        </style>
        <div class="layout horizontal wrap">
            <template is="dom-repeat" items="{{appCollectionJson}}">
                <app-wrapper app-info="{{item}}" on-open-info="_handleInfoRequest"></app-wrapper>
            </template>
        </div>

        <div id="infoScreen" class="infoScreen" hidden>
            <div id="closeInfo" class="closeButton layout horizontal center center-justified"><span>X</span></div>
        </div>
    </template>
    <script>
        Polymer({
            is: "app-collection",

            properties:{
                srcJson: String,
                appCollectionJson: {
                    type: Array/Object,
                    observer: "_foo"
                }
            },

            ready: function(){
                this._setAppCollectionJson();
                this.$.closeInfo.addEventListener("click", this._handleCloseInfo.bind(this))

            },

            _foo: function(){
                var appWrapperElements = Polymer.dom(this.root).querySelectorAll("app-wrapper");
                console.log(appWrapperElements);
            },

            _setAppCollectionJson: function(){
                var oReq = new XMLHttpRequest();
                var that = this;

                function reqListener() {
                   that.appCollectionJson = JSON.parse(this.responseText);
                }

                oReq.open("GET", this.srcJson);
                oReq.send();

                oReq.addEventListener("load", reqListener);
                oReq.addEventListener("error", function(){alert("Server currently unavailable")});
            },

            _handleCloseInfo: function(){
                Polymer.dom(this.$.infoScreen).setAttribute("hidden", true);
            },

            _handleInfoRequest: function(e) {
                this.$.infoScreen.removeAttribute("hidden");
            }
        })
    </script>
</dom-module>