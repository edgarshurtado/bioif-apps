<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../app-wrapper/app-wrapper.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">


<dom-module id="app-collection">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment iron-positioning">
            app-wrapper {
                --app-wrap-width: 250px;
                --app-icon-height: 150px;
                margin: 10px;
            }

            .infoScreen{
                position: absolute;
                top: 0;
                left: 0;
                height: 100%;
                width: 100%;
                background-color: rgba(0,0,0, 0.9);
                z-index: 1000;
                color: white;
            }

            .infoScreen .closeButton {
                position: absolute;
                right: 3%;
                top: 3%;
                border-radius: 50%;
                width: 30px;
                height: 30px;
                border: white solid 3px;
                z-index: 1001;
                cursor: pointer;
            }

            .info-section {
                width: 50%;
            }

            .completeDescription {
                width: 75%;
                height: 60vh;
                font-size: 1.2em;
                overflow-y: scroll;
            }

            a {
                color: lightgreen;
            }

        </style>
        <div class="layout horizontal wrap">
            <template is="dom-repeat" items="{{appCollectionJson}}">
                <app-wrapper app-info="{{item}}" on-open-info="_handleInfoRequest"></app-wrapper>
            </template>
        </div>

        <div id="infoScreen" class="infoScreen layout horizontal" hidden>
            <div id="closeInfo" on-click="_handleCloseInfo" class="closeButton layout horizontal center center-justified">
                <span>X</span>
            </div>
            <div class="info-section left"></div>
            <div class="info-section right">
                <h1 id="appName"></h1>
                <h2 id="appShortDescription"></h2>
                <div id="completeDescription" class="completeDescription"></div>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: "app-collection",

            properties:{
                srcJson: String,
                appCollectionJson: {
                    type: Array/Object
                }
            },

            ready: function(){
                this._setAppCollectionJson();
            },

            _setAppCollectionJson: function(){
                var oReq = new XMLHttpRequest();
                var that = this;

                function reqListener() {
                   that.appCollectionJson = JSON.parse(this.responseText);
                }

                oReq.open("GET", this.srcJson);
                oReq.send();

                oReq.addEventListener("load", reqListener);
                oReq.addEventListener("error", function(){alert("Server currently unavailable")});
            },

            _handleCloseInfo: function(){
                Polymer.dom(this.$.infoScreen).setAttribute("hidden", "");
            },

            _handleInfoRequest: function(e) {

                Polymer.dom(this.$.appName).textContent = e.detail.name;
                Polymer.dom(this.$.appShortDescription).textContent = e.detail.shortDescription;
                //Polymer.dom(this.$.completeDescription).innerHtml = e.detail.completeDescription;
                this.$.completeDescription.innerHTML = e.detail.completeDescription;


                this.$.infoScreen.removeAttribute("hidden");
            }
        })
    </script>
</dom-module>