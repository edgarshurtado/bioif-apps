<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../app-wrapper/bz-wrapper.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">


<dom-module id="bz-collection">
    <template>
        <style is="custom-style" include="iron-flex iron-flex-alignment iron-positioning">

            .apps-scroll{
                height: 100vh;
                overflow-y: scroll;
                background-color: rgb(45, 64, 82);
                padding-top: 5px;
                width: var(--apps-scroll-width, 200px);
                overflow: -moz-scrollbars-none;
            }

            .apps-scroll::-webkit-scrollbar{
                display: none;
            }

            bz-wrapper {
                width: 100%;
            }

        </style>
        <div class="layout vertical apps-scroll center">
            <template is="dom-repeat" items="{{appCollectionJson}}">
                <bz-wrapper app-info="{{item}}" on-change-active="_handleActivation"></bz-wrapper>
            </template>
        </div>
    </template>
    <script>
        Polymer({
            is: "bz-collection",

            properties:{
                srcJson: String,
                appCollectionJson: {
                    type: Array/Object
                },
                activeObject: {
                    type:Object,
                    value: undefined
                }
            },

            ready: function(){
                this._setAppCollectionJson();
            },

            _setAppCollectionJson: function(){
                var oReq = new XMLHttpRequest();
                var that = this;

                function reqListener() {
                    that.appCollectionJson = JSON.parse(this.responseText);
                }

                oReq.open("GET", this.srcJson);
                oReq.send();

                oReq.addEventListener("load", reqListener);
                oReq.addEventListener("error", function(){alert("Server currently unavailable")});
            },

            _handleCloseInfo: function(){
                Polymer.dom(this.$.infoScreen).setAttribute("hidden", "");
            },

            _handleInfoRequest: function(e) {

                Polymer.dom(this.$.appName).textContent = e.detail.name;
                Polymer.dom(this.$.appShortDescription).textContent = e.detail.shortDescription;
                this.$.completeDescription.innerHTML = e.detail.completeDescription;


                this.$.infoScreen.removeAttribute("hidden");
            },

            _handleActivation: function(e){
                if(this.activeObject !== undefined){
                    this.activeObject.activated = false;
                }
                this.activeObject = Polymer.dom(e).rootTarget;
                this.fire("app-selected", e.detail);

            },

            setAppActive: function(position) {
                var apps = Polymer.dom(this.root).querySelectorAll("bz-wrapper");
                apps[position].activated = true;
            }
        })
    </script>
</dom-module>
