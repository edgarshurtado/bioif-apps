<link rel="import" href="../polymer/polymer.html">
<link rel="stylesheet" href="../font-awesome/css/font-awesome.css">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../app-collection/bz-collection.html">
<link rel="import" href="../app-wrapper/bz-wrapper.html">
<link rel="import" href="../app-info/app-info.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">

<dom-module id="bioinfo-apps-main">
    <template>
        <style is="custom-style" include="iron-flex">

            app-info {
                height:100vh;
                overflow-y: scroll;
                overflow-x: hidden;
            }

        </style>

        <iron-media-query query="(max-width:1600px)" query-matches="{{mediumWidth}}"></iron-media-query>
        <iron-media-query query="(max-width:1130px)" query-matches="{{_tabletWidth}}"></iron-media-query>
        <!--TODO: Delete all references for the media query below-->
        <iron-media-query query="(max-height:760px)" query-matches="{{short}}"></iron-media-query>
        <div class="layout horizontal">
            <bz-collection
                    src-json="./src/test-apps.json"
                    on-app-selected="_handleAppSelection"
                    display-mode="{{_displayType}}">
            </bz-collection>
            <app-info id="appInfo"
                display-mode="{{_displayType}}"
            ></app-info>
        </div>
    </template>
    <script>
        Polymer({
            is: "bioinfo-apps-main",

            ready: function() {
                var collection = Polymer.dom(this.root).querySelector("bz-collection");
                var that = this;
                // Needed to wait until the dom-repeat of `<bz-collection>` is initialized
                collection.addEventListener("dom-change", function(){
                    collection.setAppActive(0);
                });
            },

            properties: {
                mediumWidth: {
                    type: Boolean,
                    observer: "_changedWidth"
                },
                _tabletWidth: {
                    type: Boolean,
                    observer: "_changedWidth"

                },

                short: {
                    type: Boolean,
                    observer: "_changedHeight"
                },
                _displayType: String
            },

            _handleAppSelection(e){
                var a = Polymer.dom(this.root).querySelector("app-info");
                a.appToDisplay = e.detail;
            },

            _changedWidth: function() {
                if(this._tabletWidth){
                    this._displayType="tablet";
                }else {
                    this._displayType="";
                }
            },

            _changedHeight: function() {
                Polymer.dom(this.root).querySelector("app-info").short = this.short;
            }

        })
    </script>
</dom-module>